name: 20 - SCA

on:
  workflow_dispatch:
  workflow_call:
    secrets:
      SNYK_TOKEN:
        required: true

permissions:
  contents: read
  security-events: write

jobs:
  sca:
    runs-on: ubuntu-latest
    name: SCA - Java Project

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 11
          cache: maven

      - name: Install CRDA
        uses: redhat-actions/openshift-tools-installer@v1
        with:
          crda: 0.2.5
          source: github

      - name: Force DNS refresh
        run: |
          sudo systemctl restart systemd-resolved
          resolvectl status

      - name: SCA (CRDA) Scan
        id: scan
        uses: redhat-actions/crda@v1.2
        with:
          manifest_file: pom.xml
          snyk_token: ${{ secrets.SNYK_TOKEN }}
          fail_on: never

      - name: Print JSON report
        if: always() && steps.scan.outputs.crda_report_json
        run: cat "${{ steps.scan.outputs.crda_report_json }}"

      - name: Print SARIF report
        if: always() && steps.scan.outputs.crda_report_sarif
        run: cat "${{ steps.scan.outputs.crda_report_sarif }}"

      - name: Print report link
        run: echo "${{ steps.scan.outputs.report_link }}"

      - name: Print artifact name
        run: echo "${{ steps.scan.outputs.artifact_name }}"





